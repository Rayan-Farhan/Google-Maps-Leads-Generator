# agents/company_info_extractor_agent.py

from langchain_core.runnables import RunnableLambda
from langchain_core.prompts import PromptTemplate
from langchain_core.output_parsers import JsonOutputParser
from langchain_core.pydantic_v1 import BaseModel, Field
from typing import Dict, List
from textwrap import dedent

import os
from dotenv import load_dotenv
load_dotenv()

# 1. Define output schema using Pydantic
class CompanyInfo(BaseModel):
    description: str = Field(..., description="Short description of the business")
    unique_selling_points: List[str] = Field(..., description="List of USPs")
    target_audience: str = Field(..., description="Ideal customer profile")
    emails: List[str] = Field(..., description="Collected email addresses")
    social_links: List[str] = Field(..., description="Collected social profiles")

# 2. Create the output parser from the schema
parser = JsonOutputParser(pydantic_object=CompanyInfo)

# 3. Template prompt with format instructions
prompt = PromptTemplate.from_template(dedent("""
    You are a B2B market research assistant. Analyze the following business website content and extract the structured details.

    ### Website Raw Text:
    {raw_text}

    ### Emails:
    {emails}

    ### Social Links:
    {social_links}

    ### About Section:
    {about_section}

    {format_instructions}
"""), partial_variables={"format_instructions": parser.get_format_instructions()})

# 4. LangChain chain
def get_company_info_chain(chat_model) -> RunnableLambda:
    return prompt | chat_model | parser

# 5. Call this function from your pipeline
def extract_company_info(scraped_data: Dict, chat_model) -> Dict:
    chain = get_company_info_chain(chat_model)
    return chain.invoke(scraped_data)

#from langchain_groq import ChatGroq

#chat_model = ChatGroq(model="llama3-8b-8192", temperature=0.0)
#scraped_data_example = {'raw_text': "Home - Contour Software Skip to content Menu Menu Services Software Development Services Software Quality & Delivery Services Professional Services & IT Client Care & Maintenance Support\u2028Services Finance & Accounting Services General & Administrative Services Sales & Marketing Services About Our Story Our Team Environmental, Social and Governance (ESG) Learning and Development Compliance Certification Acquisitions Careers Life At Contour Insights Newsletters & Insights Press Room Contact Us a subsidiary of Constellation Software Inc. Currently housing employees and teams for more than 200 CSI divisional and corporate departments. Who We Are Get Hired Our footprint in numbers Real Results – Real Impact 200 Divisions 10 Awards 2100 Employees 8 Time Zones 6 Continents We Deliver Excellence. Software Development Empowering Businesses Through Technology Learn More Software Quality & Delivery Ensuring Software Reliability and Excellence Learn More Professional Services & IT Systems Administration Configuration, Implementation, Training, Administration & More Learn More Client Care & Software Support\u2028Services Enhance Your Customer Experience Learn More G&A Business\u2028Process Staff Streamline Your Operations Learn More Sales & Marketing Team\u2028Augmentation Drive Growth with Our Expertise Learn More Finance & Accounting End to end as well as specialized area expertise Learn More Who We Are Our Philosophy We are an end-to-end Global Center! Since 1995, Constellation Software Inc. (CSU.TO) has been acquiring and transforming software enterprises globally, catering to the diverse software needs of organizations and institutions from every niche. From being a rapidly growing conglomerate of vertical market software (VMS) companies, to becoming one of the top 10 software companies in the world, Constellation now has employees and customers in over 100 countries. Contour, as a wholly-owned dedicated global center for our parent company, serves to augment divisional and corporate departments belonging to business units and portfolios located all over the world. Our philosophy is to adjust to the contours of the business units we serve, in terms of their work processes, tools, technologies and methodologies, in line with Constellation’s promise to have a culture of cultures. Read More Beyond the Surface: Our Core Values At Contour Software, we are driven by a simple internal doctrine: Recruitment-Resources-Retention-Results . – Our success starts with our people, which is why we’ve built a culture that puts employees first. We invest in people, foster growth, and deliver exceptional value. As the trusted offshore staff center for Constellation Software Inc. (CSI), we house top-tier talent for CSI business units across the globe. – Equally importantly, we stay aligned with Constellation’s ethos, of keeping creative control with the business units, in terms of their unique blend of work processes, methodologies, technologies and toolkits that define them, and are at the heart of how they serve the customers in their industry domain and region. We hone, refine and provide access to best practices from across Constellation, yet adjust our teams to the eventual contours of each business unit. By staying true to these core values, we’ve become a trusted partner to our clients and a home for some of the brightest talent in the industry. At Contour, it’s not just about the work we do — it’s about the way we do it, together. Read More What Makes Us Contour We work to provide you with the work-life balance you deserve! Life at Contour We’re Hiring Get In Touch With Us Call Us +92 21 34306280 +92 42 35788961 +92 51 8460005 Email Us info@contour-software.com Locations Karachi | Lahore | Islamabad | Toronto Services Software Development Services Software Quality & Delivery Services Professional Services & IT Client Care & Maintenance Support\u2028Staff Augmentation Finance Service Line General & Administrative Business\u2028Process Staff Sales & Marketing Team\u2028Augmentation About Our Story Our Team Environmental, Social and Governance (ESG) Learning And Development Compliance Certification Acquisitions Careers Life At Contour Insights Newsletters & Insights Contact Us Services Software Development Services Software Quality & Delivery Services Professional Services & IT Client Care & Maintenance Support\u2028Staff Augmentation Finance Service Line General & Administrative Business\u2028Process Staff Sales & Marketing Team\u2028Augmentation About Our Story Our Team Environmental, Social and Governance (ESG) Learning And Development Compliance Certification Acquisitions Careers Life At Contour Insights Newsletters & Insights Contact Us Contour Software is registered with SECP and PSEB since its beginnings in 2010. While the groundwork for its inception started as early 2008, with pilot projects performed over an 18 month period in order to prove the concept, Constellation's acquisition of Gladstone PLC (now Gladstone MRM) culminated in the launch of Contour. info@conto", 'emails': ['careers@contour-software.com', 'info@contour-software.com'], 'social_links': ['https://www.youtube.com/channel/UC4sAy4M7QrRkdOyk76qkCDQ/featured', 'https://twitter.com/ContourSoftware/', 'https://pk.linkedin.com/company/contoursoftware', 'https://www.facebook.com/contoursoftware/', 'https://www.instagram.com/contoursoftwareltd/'], 'about_section': 'ftware Inc., Contour’s ultimate parent company (via Perseus/CHS), was formed in 1995 and publicly listed on the Toronto Stock Exchange in 2006. Constellation is a rapidly growing conglomerate of vertical market software (VMS) companies, each focused on dominating its respective market niche. Constellation’s growth is based on a simple strategy: identify promising VMS firms, acquire them, and then integrate them into the Constellation family while building on their fundamental strengths to help them become world-class organizations. Before it went public, Constellation was recognized among Canada’s Best Managed Companies. Today, Constellation is the\xa0largest\xa0Canadian software company by revenue; its stock has\xa0outperformed\xa0some of the biggest names in the global tech ecosystem, and it is the top global acquirer of software companies for 2017 , 2018 & 2019 . Constellation software systems run public and private sector enterprises globally, including utility companies, city transit systems, paper mills, schools, hospitals, hotels, manufacturing companies, construction firms, retailers, leasing, financing, and digital banking companies, agri-food businesses, amusement parks, museums, city governments, attorney offices, jails, and more. While initially an offshore Development Centre, today Contour is serving as a full-featured Global Centre, providing services covering all functional areas to 200+ of the parent company’s divisions and corporate departments located worldwide. Contour continues to grow as one of the top tech employers in Pakistan: 2024 Top 5 IT Exporter Awards by MoIT & PSEB. 2023 FBR Excellence Award for Leading Exporter. 2022-2023 P@SHA ICT Award for Export Growth. 2022-2023 P@SHA ICT Award for Gender Diversity. 2023 Syed Bilal Mahmood, MD, received the Thought Leader Excellence Award from the Honorable President of Pakistan at Digital Summit 2023. 2020-2021 P@SHA ICT Award for Export Growth 2019 PSEB Silver Award for IT Consultancy Services 2019 PSEB Platinum Award for Export Growth 2019 Syed Bilal Mahmood, Contour’s MD, received the Canada Pakistan Business Council’s Business Excellence Award We Deliver Excellence Real Results – Real Impact 200 Divisions 10 Awards 2100 Employees 8 Time Zones 6 Continents Contour is now also actively acquiring vertical market software companies in the region, per its parent company’s core mandate . In April 2022, it completed its first acquisition of AutoSoft Dynamics (Pvt) Limited, a Pakistan-based software company. What Makes Us Contour We work to provide you with the work-life balance you deserve! Life at Contour We’re Hiring Get In Touch With Us Call Us +92 21 34306280 +92 42 35788961 +92 51 8460005 Email Us info@contour-software.com Locations Karachi | Lahore | Islamabad | Toronto\n\nHome About Our Story Beyond Software, Delivering Value! Let’s Build Something Great Together Contour Software: a Global Technology Leader Contour Software started from Karachi in 2010, with a little over a dozen people, and has grown to 2,000 people in 13 years, with offices in Karachi, Lahore and Islamabad, serving client divisions located all across the globe. Contour was founded in 2010 as a result of 18 months of pre-acquisition diligence, as well as pilot projects involving Pakistani freelancers and Constellation Software’s ultimate acquisition of Gladstone PLC UK (via Constellation’s Jonas operating group ). Syed Bilal Mahmood , who had been working to prove the concept within Constellation’s Perseus (formerly named CHS ) operating group, moved from Canada to Pakistan, post-acquisition, to take the Karachi branch forward, as a joint venture between the two operating groups before eventually expanding to serve most of the parent organization’s operating divisions. Constellation Software Inc., Contour’s ultimate parent company (via Perseus/CHS), was formed in 1995 and publicly listed on the Toronto Stock Exchange in 2006. Constellation is a rapidly growing conglomerate of vertical market software'}
#extracted_info = extract_company_info(scraped_data_example, chat_model)
#print(extracted_info)